<!-- 14. Logarithm and Exponential Decoder (Fully MathJax-Rendered) -->
<!DOCTYPE html>
<html>
<head>
  <title>Logarithm and Exponential Decoder</title>
  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
</head>
<body>
  <h2>Logarithm and Exponential Practice</h2>
  <p>Simplify the expression:</p>
  <div id="question" style="font-weight: bold; font-size: 1.2em;"></div>

  <label>Your Answer:
    <input type="text" id="userAnswer" placeholder="e.g., log(10), exp(3), 2">
  </label>
  <button onclick="checkLogAnswer()">Submit</button>
  <button onclick="showRules()">Log Rules</button>

  <div id="logFeedback"></div>
  <div id="logSolution" style="margin-top: 1em; font-size: 1.1em;"></div>
  <div id="logRuleHint" style="margin-top: 1em; font-size: 1em; color: #555;"></div>
  <div id="scoreDisplay" style="margin-top: 1em; font-size: 1.1em; font-weight: bold;"></div>

  <script>
    let currentLogProblem = {};
    let score = 0;
    let total = 0;

    const ruleHints = {
      product: '\\log(ab) = \\log(a) + \\log(b)',
      quotient: '\\log(a/b) = \\log(a) - \\log(b)',
      power: '\\log(a^n) = n \\log(a)',
      logExp: '\\log(e^x) = x',
      expLog: 'e^{\\log(x)} = x'
    };

    function getRandomInt(min, max) {
      return Math.floor(Math.random() * (max - min + 1)) + min;
    }

    function generateLogQuestion() {
      const type = getRandomInt(1, 5);
      let exprJS = '', simplifiedJS = '', displayLatex = '', questionLatex = '', ruleKey = '';
      let a, b;

      switch (type) {
        case 1:
          a = getRandomInt(2, 9);
          b = getRandomInt(2, 9);
          exprJS = `Math.log(${a}) + Math.log(${b})`;
          simplifiedJS = `Math.log(${a * b})`;
          questionLatex = `\\log(${a}) + \\log(${b})`;
          displayLatex = `\\log(${a}) + \\log(${b}) = \\log(${a * b})`;
          ruleKey = 'product';
          break;
        case 2:
          a = getRandomInt(10, 50);
          b = getRandomInt(2, 9);
          exprJS = `Math.log(${a}) - Math.log(${b})`;
          simplifiedJS = `Math.log(${(a / b).toFixed(4)})`;
          questionLatex = `\\log(${a}) - \\log(${b})`;
          displayLatex = `\\log(${a}) - \\log(${b}) = \\log(${(a / b).toFixed(4)})`;
          ruleKey = 'quotient';
          break;
        case 3:
          a = getRandomInt(2, 5);
          b = getRandomInt(2, 4);
          exprJS = `${b} * Math.log(${a})`;
          simplifiedJS = `Math.log(${Math.pow(a, b)})`;
          questionLatex = `${b} \\log(${a})`;
          displayLatex = `${b} \\log(${a}) = \\log(${Math.pow(a, b)})`;
          ruleKey = 'power';
          break;
        case 4:
          a = getRandomInt(1, 5);
          exprJS = `Math.log(Math.exp(${a}))`;
          simplifiedJS = `${a}`;
          questionLatex = `\\log(e^{${a}})`;
          displayLatex = `\\log(e^{${a}}) = ${a}`;
          ruleKey = 'logExp';
          break;
        case 5:
          a = getRandomInt(2, 12);
          exprJS = `Math.exp(Math.log(${a}))`;
          simplifiedJS = `${a}`;
          questionLatex = `e^{\\log(${a})}`;
          displayLatex = `e^{\\log(${a})} = ${a}`;
          ruleKey = 'expLog';
          break;
      }

      currentLogProblem = {
        expr: exprJS,
        simplified: simplifiedJS,
        question: questionLatex,
        display: displayLatex,
        rule: ruleHints[ruleKey]
      };

      document.getElementById('question').innerHTML = `\\[ ${currentLogProblem.question} \\]`;
      document.getElementById('userAnswer').value = '';
      document.getElementById('logFeedback').innerText = '';
      document.getElementById('logSolution').innerText = '';
      document.getElementById('logRuleHint').innerText = '';
      MathJax.typeset();
      updateScoreDisplay();
    }

    function preprocessUserInput(input) {
      return input
        .replace(/\blog\(/g, 'Math.log(')
        .replace(/\bexp\(/g, 'Math.exp(')
        .replace(/\^/g, '**');
    }

    function checkLogAnswer() {
      const rawInput = document.getElementById('userAnswer').value.trim();
      const safeInput = preprocessUserInput(rawInput);
      let correct = false;
      try {
        const correctVal = eval(currentLogProblem.simplified);
        const userVal = eval(safeInput);
        correct = Math.abs(userVal - correctVal) < 0.001;
      } catch (e) {
        correct = false;
      }

      total++;
      if (correct) {
        score++;
        document.getElementById('logFeedback').innerText = '✅ Correct!';
        updateScoreDisplay();
        setTimeout(() => generateLogQuestion(), 1500);
      } else {
        document.getElementById('logFeedback').innerText = '❌ Incorrect. See solution and rule below.';
        showLogSolution();
        showLogRule();
        updateScoreDisplay();
        setTimeout(() => generateLogQuestion(), 5000);
      }
    }

    function showLogSolution() {
      document.getElementById('logSolution').innerHTML = `\\[ ${currentLogProblem.display} \\]`;
      MathJax.typeset();
    }

    function showLogRule() {
      document.getElementById('logRuleHint').innerHTML = `\\[ ${currentLogProblem.rule} \\]`;
      MathJax.typeset();
    }

    function showRules() {
      alert(`Logarithmic & Exponential Rules:\n
log(ab) = log(a) + log(b)\n
log(a/b) = log(a) - log(b)\n
log(a^n) = n * log(a)\n
exp(log(a)) = a\n
log(exp(a)) = a`);
    }

    function updateScoreDisplay() {
      document.getElementById('scoreDisplay').innerText = `Score: ${score} / ${total}`;
    }

    window.onload = generateLogQuestion;
  </script>
</body>
</html>