<!-- 14. Logarithm and Exponential Decoder (User-Friendly Input, Randomized, with MathJax) -->
<!DOCTYPE html>
<html>
<head>
  <title>Logarithm and Exponential Decoder</title>
  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
</head>
<body>
  <h2>Logarithm and Exponential Practice</h2>
  <p>Simplify the expression:</p>
  <div id="question" style="font-weight: bold; font-size: 1.2em;"></div>

  <label>Your Answer:
    <input type="text" id="userAnswer" placeholder="e.g., log(10), exp(3), 2">
  </label>
  <button onclick="checkLogAnswer()">Check Answer</button>
  <button onclick="showLogSolution()">Show Solution</button>
  <button onclick="generateLogQuestion()">New Problem</button>
  <button onclick="showRules()">Log Rules</button>

  <div id="logFeedback"></div>
  <div id="logSolution" style="margin-top: 1em; font-size: 1.1em;"></div>

  <script>
    let currentLogProblem = {};

    function getRandomInt(min, max) {
      return Math.floor(Math.random() * (max - min + 1)) + min;
    }

    function generateLogQuestion() {
      const type = getRandomInt(1, 5);
      let exprJS = '', simplifiedJS = '', displayLatex = '';
      let a, b;

      switch (type) {
        case 1:
          a = getRandomInt(2, 9);
          b = getRandomInt(2, 9);
          exprJS = `Math.log(${a}) + Math.log(${b})`;
          simplifiedJS = `Math.log(${a * b})`;
          displayLatex = `\\log(${a}) + \\log(${b}) = \\log(${a * b})`;
          break;
        case 2:
          a = getRandomInt(10, 50);
          b = getRandomInt(2, 9);
          exprJS = `Math.log(${a}) - Math.log(${b})`;
          simplifiedJS = `Math.log(${(a / b).toFixed(4)})`;
          displayLatex = `\\log(${a}) - \\log(${b}) = \\log(${(a / b).toFixed(4)})`;
          break;
        case 3:
          a = getRandomInt(2, 5);
          b = getRandomInt(2, 4);
          exprJS = `${b} * Math.log(${a})`;
          simplifiedJS = `Math.log(${Math.pow(a, b)})`;
          displayLatex = `${b} \\log(${a}) = \\log(${Math.pow(a, b)})`;
          break;
        case 4:
          a = getRandomInt(1, 5);
          exprJS = `Math.log(Math.exp(${a}))`;
          simplifiedJS = `${a}`;
          displayLatex = `\\log(e^{${a}}) = ${a}`;
          break;
        case 5:
          a = getRandomInt(2, 12);
          exprJS = `Math.exp(Math.log(${a}))`;
          simplifiedJS = `${a}`;
          displayLatex = `e^{\\log(${a})} = ${a}`;
          break;
      }

      currentLogProblem = {
        expr: exprJS,
        simplified: simplifiedJS,
        display: displayLatex
      };

      document.getElementById('question').innerText = exprJS.replace(/Math\.(log|exp)/g, '$1');
      document.getElementById('userAnswer').value = '';
      document.getElementById('logFeedback').innerText = '';
      document.getElementById('logSolution').innerText = '';
    }

    function preprocessUserInput(input) {
      return input
        .replace(/\blog\(/g, 'Math.log(')
        .replace(/\bexp\(/g, 'Math.exp(')
        .replace(/\^/g, '**');
    }

    function checkLogAnswer() {
      const rawInput = document.getElementById('userAnswer').value.trim();
      const safeInput = preprocessUserInput(rawInput);
      try {
        const correctVal = eval(currentLogProblem.simplified);
        const userVal = eval(safeInput);
        const correct = Math.abs(userVal - correctVal) < 0.001;
        document.getElementById('logFeedback').innerText = correct ? '✅ Correct!' : '❌ Try again!';
      } catch (e) {
        document.getElementById('logFeedback').innerText = 'Error in your expression.';
      }
    }

    function showLogSolution() {
      document.getElementById('logSolution').innerHTML = `\\[ ${currentLogProblem.display} \\]`;
      MathJax.typeset();
    }

    function showRules() {
      alert(`Logarithmic & Exponential Rules:\n
log(ab) = log(a) + log(b)\n
log(a/b) = log(a) - log(b)\n
log(a^n) = n * log(a)\n
exp(log(a)) = a\n
log(exp(a)) = a`);
    }

    window.onload = generateLogQuestion;
  </script>
</body>
</html>
